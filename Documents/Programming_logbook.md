# Programming logbook

### 07/05/2020
#### Main Simulation
The goal of today will be to create a good mesh for our problem. 
I found an interesting forum [discussion](https://www.cfd-online.com/Forums/openfoam-meshing/88973-simple-sphere-snappyhexmesh.html) about meshing spheres in openFoam.
Post #7 seems promising to me, he shares 2 different snappyHexMesh files (a meshing utility in openFoam to alter simple blockmeshes) and a blockmesh file.
I will first just coppy these files in the case, run them by first using the blockMesh command and then the snappyHexMesh command.
Then I will look at the meshes created in paraView and adjust from there.

![snappyHexMeshDictSphere](https://user-images.githubusercontent.com/64592913/81285483-e5357480-905f-11ea-9191-4e8c030712b7.png)

This is the mesh generated by the snappyHexMeshDictSphere file in the previously described forum post. 
It looks like a good starting point but lets double check the mesh generated by the other snappyHexMeshDict file in the forum post.

![snappyHexMeshDictCavity](https://user-images.githubusercontent.com/64592913/81286536-7f49ec80-9061-11ea-94db-64cf8323d295.png)

This is the mesh generated by the snappyHexMeshDictcavity file. This is further away from our goal mesh so I'll use the snappyHexMeshDictSphere file as starting point.

#### Salt concentration 
I coppied the NernstPlanck ICEO tutorial case file over and named it saltConcentration. I'll start by changing the blockmesh file located in constant/polymesh to a 1D case.  Only 8 vertices and 1 block is needed to define this geometry, I'll start with simplegrading (1 1 1) of the block can be later refined if needed. Changing the boundary condition to 1D by making the sides also empty, and defining the correct patches for the electrodes. Keep in mind that the order in which you state the vertices for the blocks and boundary conditions has to follow certain rules described in the openFoam userguide section 5.3. Lets inspect the created mesh in paraview. 

![saltConcentrationMesh](https://user-images.githubusercontent.com/64592913/81297779-128c1d80-9074-11ea-9557-8616da09045c.png)

This looks like the right 1D mesh so lets continue with the other files. lets start with the 0 directory, we need to change all the boundary condition names to match the ones we just defined in the blockMeshDict file I'll mention if I change the condition itself. in the cAnion and cCation files the boundary conditions at the electrodes must be changed from fixed values, I think zeroIonicFlux will be a good boundary condition to use here. There is a value entry for this B.C. I hope this doesn't fix the value in time otherwise I'll have to change this B.C.. In the psi file I changed the value of the  elecNorth to 0.025V and changed the value of the electSouth to 0V. 

Nothing needs to be changed in the constant directory for now, in the electricProperties file we can change the charge/diffusivity of the ions. Changing the charge and diffusivity of the ions will be needed to reproduce results. 

### 08/05/2020
#### salt concentration
I will use the sample tool provided by openFoam, this lets me read out the ion concentrations allong a line. The sampleDict file is in the system directory. I took out the psi and u from the fields to be sampled because we are only interested in the ion concentrations. I changed the type to uniform and the axis to Z, I added nPoints since this is needed with a uniform line and i put it to 50 and i changed the start and end points to match our geometry. I deleted the probes function out of the controlDict file and the jMonitor and ciMonitor functions from the fvSolution file since the sample utility will be all we need for our purpose. 

Now I think everything is ready so lets run it by first entering "blockMesh" and then "rheoEFoam" in the terminal. 

[this](https://www.cfd.at/sites/default/files/tutorialsV4/14-ExampleFourteen.pdf) tutorial explains how to incorperate the sample function while the simulation is running, that might be interesting to explore at a later time.

### 11/05/2020
#### salt concentration
The simulation took 20 hours to simulate 0.15 seconds on my laptop, I think it an definetly be refined to run quicker. Some thing to look into are taking out the Navier-Stokes equations, bigger delta t timesteps, smaller simulation time if the data converges to a value quicker then after 0.15 seconds. 

Before going into the refinement lets first look if the simulation actually did what we would expect. by running the "sample" command in the case directorie a new directorie gets created named sets wherin the ion concentrations of different times are stored in .xy files. We first have to convert these files to .txt files to import them to python (I didn't find a way to input the .xy files directly but maybe that's also possible) I'll save the converted files in the new Data folder in this repository.

I imported the data to python and put it in different graphs for each timestep. As can be seen from these graphs the ionic concentrations converge within 0.03 seconds to their end values since from that point onward there is no more change in the graphs, this means that letting the simulation run until 0.03s will be suficient. I didn't expect to see a linear relation between the ion concentrations and the distance from the electrode because of shielding from the EDL, so I think something went wrong.
![saltConcentration_firstRun](https://user-images.githubusercontent.com/64592913/81566078-a3c40280-939a-11ea-9f7e-853e114eb62b.png)

### 12-05-2020
#### salt concentration
Last night I run the simulation while turning of the Navier-Stokes equations in the fvSolution file in the system case directory to check if the results would be the same. This time the simulation finished in 4.5 hours so it took a lot shorter time to simulate the 0.15 seconds. The results look exactly the same so for our purpose I keep the Navier-Stokes equations turned off during future runs
![saltConcentration_secondRun](https://user-images.githubusercontent.com/64592913/81671989-d2e57d00-9449-11ea-82ee-ea0c2b30d705.png)


